
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>使用MATLAB进行USB摄像头的编程 | Opengcl</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="snailgoers">
    
    <meta name="description" content="1、查询USB2.0Camera 的具体参数(imaqhwinfo)
2、创建视频输入对象(videoinput)
3、图像预览和显示(preview、stoppreview、closepreview和image)
4、获取视频图像(getsnapshot)
5、图像获取设备的获取和设置(get和set)
6、关闭视频对象(delete)">
    
    
    <meta name="keywords" content="算法,设计,学习,分享,图像处理,计算几何,通用计算库,视频处理,人工智能,大数据处理,智能家居">
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div id="header">
    <div id="textlogo">
        <h1><a href="/" title="Opengcl">Opengcl</a></h1>
    </div>
    <nav id="nav" role="navigation">
         <ul>
             
                <li><a href="/">Home</a></li>
            
                <li><a href="/categories">Categories</a></li>
            
                <li><a href="/archives">Archives</a></li>
            
                <li><a href="/about">About</a></li>
            
        </ul>
    </nav>
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/05/04/使用matlab进行usb摄像头编程/" title="使用MATLAB进行USB摄像头的编程" itemprop="url">使用MATLAB进行USB摄像头的编程</a>
  </h1>

  <p class="article-time">
    <time datetime="2014-05-04T05:10:59.000Z" itemprop="datePublished">May 4 2014</time>
  </p>
</header>

	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
		</div>
		
		<p>1、查询USB2.0Camera 的具体参数(imaqhwinfo)</p>
<p>2、创建视频输入对象(videoinput)</p>
<p>3、图像预览和显示(preview、stoppreview、closepreview和image)</p>
<p>4、获取视频图像(getsnapshot)</p>
<p>5、图像获取设备的获取和设置(get和set)</p>
<p>6、关闭视频对象(delete)<br><a id="more"></a><br>在正式讲解之前，我想说明下几个个在图像获取工具箱中的术语：</p>
<p>图像获取设备：比如摄像头、扫描仪</p>
<p>图像获取适配器：主要的目的是通过驱动在Matlab和图像获取设备之间传递信息</p>
<p>ROI：region-of-interest 感兴趣区域</p>
<p>在说说几个常用的函数，我们这里只是说明它的作用，具体如何使用参考帮助系统</p>
<pre><code><span class="title">getselectedsource</span>
imaqfind
isvalid
peekdata
getdata
imaqmontage
</code></pre><p>给我们一个摄像头我们必须知道他的相关参数，才可能进行我们的编程下。当然我们可以查询商家手册，但是那个累不累人呀。</p>
<p>Matlab的图像获取工具箱为我提供了imaqhwinfo()，来获取PC上以安装的图像获取硬件信息</p>
<p>没有输入参数时，返回一个结构体， 它包含了系统中存在的适配器和Matlab相关的版本信息(第一次我们一般使用这个)</p>
<p>代码:</p>
<pre><code><span class="attribute">info</span>=<span class="string">imaqhwinfo</span>
</code></pre><p>info =</p>
<pre><code><span class="attribute">InstalledAdaptors</span>: <span class="string">{'coreco'  'winvideo'}%这里可以看到我的PC上安装了两个适配器</span>

<span class="http">    <span class="attribute">MATLABVersion</span>: <span class="string">'7.6 (R2008a)'</span>

<span class="http">      <span class="attribute">ToolboxName</span>: <span class="string">'Image Acquisition Toolbox'</span>

<span class="css">   <span class="rule"><span class="attribute">ToolboxVersion</span>:<span class="value"> <span class="string">'3.1 (R2008a)'</span></span></span></span></span></span>
</code></pre><p>有输入参数的时候，返回一个结构体，包含了指定的适配器的数据信息</p>
<p>代码:</p>
<pre><code><span class="function_or_atom">win_info</span>=<span class="function_or_atom">imaqhwinfo</span>(<span class="string">'winvideo'</span>)<span class="comment">%我们看看第二适配器的具体参数</span>
</code></pre><p>win_info =</p>
<pre><code>   <span class="attribute">AdaptorDllName</span>: <span class="string">[1x81 char]%适配器dll文件绝对路径</span>

<span class="http"><span class="attribute">AdaptorDllVersion</span>: <span class="string">'3.1 (R2008a)'%适配器dll文件版本</span>

<span class="http">      <span class="attribute">AdaptorName</span>: <span class="string">'winvideo'%s适配器名称</span>

<span class="http">        <span class="attribute">DeviceIDs</span>: <span class="string">{[1]}%设备ID号，这个我们经常需要用到</span>

<span class="cpp">       DeviceInfo: [<span class="number">1</span>x1 <span class="keyword">struct</span>]%设备信息，这里主要是图像获取设备的一些参数，比较重要</span></span></span></span>
</code></pre><p>%====================下面我们了解下，这个图像获取设备到底有哪些的详细信息吧====================</p>
<pre><code><span class="tag">win_info</span><span class="class">.DeviceIDs</span>
</code></pre><p>ans =</p>
<pre><code><span class="title">[1]</span>

<span class="setting">dev_win_info=<span class="value">win_info.DeviceInfo</span></span>
</code></pre><p>dev_win_info =</p>
<pre><code>      <span class="attribute">DefaultFormat</span>: <span class="string">'RGB24_320x240'%获取图片的默认格式</span>

<span class="http"><span class="attribute">DeviceFileSupported</span>: <span class="string">0</span>

<span class="http">         <span class="attribute">DeviceName</span>: <span class="string">'USB PC CAMERA P227'%设备名称</span>

<span class="http">           <span class="attribute">DeviceID</span>: <span class="string">1%设备号</span>

<span class="http">  <span class="attribute">ObjectConstructor</span>: <span class="string">'videoinput('winvideo', 1)'%对象构建方式，这个绝大部分都是一样的</span>

<span class="http">   <span class="attribute">SupportedFormats</span>: <span class="string">{1x12 cell}%获取的图像支持格式，一般都有好多种，上面的DefaultFormat只是默认格式而已</span></span></span></span></span></span>
</code></pre><p>%==================================看看图像获取设备支持的图像格式==================================</p>
<pre><code><span class="label">dev_win_info.SupportedFormats</span>%可以看到我的<span class="literal">PC</span>上的摄像头支持下面<span class="number">12</span>中图片格式
</code></pre><p>ans =</p>
<p>  Columns 1 through 5</p>
<pre><code><span class="string">'I420_160x120'</span>    <span class="string">'I420_176x144'</span>    <span class="string">'I420_320x240'</span>    <span class="string">'I420_352x288'</span>    <span class="string">'I420_640x480'</span>
</code></pre><p>  Columns 6 through 9</p>
<pre><code><span class="string">'RGB24_1280x960'</span>    <span class="string">'RGB24_160x120'</span>    <span class="string">'RGB24_176x144'</span>    <span class="string">'RGB24_320x240'</span>
</code></pre><p>  Columns 10 through 12</p>
<pre><code><span class="string">'RGB24_352x288'</span>    <span class="string">'RGB24_640x480'</span>    <span class="string">'RGB24_800x600'</span>
</code></pre><p>视频预览、采集和保存</p>
<p>(1)创建视频输入对象</p>
<pre><code>obj = <span class="function"><span class="title">videoinput</span><span class="params">(adaptorname,deviceID,format)</span></span>
</code></pre><p>adaptorname：适配器名称，首次可以使用不带参数的imaqhwinfo函数获取</p>
<p>deviceID：设备ID号，首次可以通过imaqhwinfo函数获取</p>
<p>format：视频采集格式，可以通过DeviceInfo的SupportedFormats获取，不填写则使用默认格式</p>
<p>代码:</p>
<pre><code>obj = videoinput(<span class="string">'winvideo'</span>,<span class="number">1</span>,<span class="string">'RGB24_320x240'</span>)%这里我们使用默认的视频采集格式

Summary <span class="operator">of</span> Video Input Object Using <span class="string">'USB PC CAMERA P227'</span>.

Acquisition Source(s):  input1 is available.

Acquisition Parameters:  <span class="string">'input1'</span> is <span class="operator">the</span> current selected source.

                       <span class="number">10</span> frames per trigger <span class="keyword">using</span> <span class="operator">the</span> selected source.

                       <span class="string">'RGB24_320x240'</span> video data <span class="built_in">to</span> be logged upon START.

                       Grabbing <span class="keyword">first</span> <span class="operator">of</span> every <span class="number">1</span> frame(s).

                       Log data <span class="built_in">to</span> <span class="string">'memory'</span> <span class="command"><span class="keyword">on</span> <span class="title">trigger</span>.</span>

  Trigger Parameters:  <span class="number">1</span> <span class="string">'immediate'</span> trigger(s) <span class="command"><span class="keyword">on</span> <span class="title">START</span>.</span>

              Status:  Waiting <span class="keyword">for</span> START.

                       <span class="number">0</span> frames acquired since starting.

                       <span class="number">0</span> frames available <span class="keyword">for</span> GETDATA.
</code></pre><p>(2)打开视频预览窗口</p>
<pre><code>himage=<span class="function"><span class="title">preview</span><span class="params">(obj,himage)</span></span>
</code></pre><p>obj：视频采集对象</p>
<p>himage：视频预览窗口对应的句柄，也就是说在指定的句柄对象中预览视频，该参数可以空缺</p>
<p>至于预览窗口的关闭和停止可以使用colsepreview和stoppreview函数</p>
<p>代码:</p>
<p>vidRes = get(obj, ‘VideoResolution’);</p>
<p>nBands = get(obj, ‘NumberOfBands’);</p>
<p>figure()%指定预览窗体显示的figure</p>
<p>axes()%指定预览窗口显示的坐标系</p>
<p>hImage = image( zeros(vidRes(2), vidRes(1), nBands) );</p>
<p>preview(obj, hImage);</p>
<p>(3)图像捕捉、显示和保存</p>
<p>代码:</p>
<p>%frame是H×W×B的矩阵。H图像高度，由ROIPosition指定；w图像宽度，由ROIPosition指定；B索线个数，由NumberOfBands指定</p>
<pre><code>frame = getsnapshot<span class="list">(<span class="keyword">obj</span>)</span><span class="comment">;</span>
imshow<span class="list">(<span class="keyword">frame</span>)</span><span class="comment">;</span>
imwrite<span class="list">(<span class="keyword">fame</span>,<span class="quoted">'snap</span>.jpg',<span class="quoted">'jpg</span>')</span><span class="comment">;</span>
</code></pre><p>实验步骤</p>
<p>1、 查询USB2.0Camera 的具体参数</p>
<p>输入</p>
<pre><code><span class="attribute">imaqInfo </span>=<span class="string"> imaqhwinfo</span>
</code></pre><p>返回信息</p>
<p>InstalledAdaptors: {‘winvideo’}</p>
<p>MATLABVersion: ‘7.1 (R14SP3)’</p>
<p>ToolboxName: ‘Image Acquisition Toolbox’</p>
<p>ToolboxVersion: ‘1.9 (R14SP3)’</p>
<p>输入</p>
<pre><code><span class="tag">imaqInfo</span><span class="class">.InstalledAdaptors</span>
</code></pre><p>返回信息</p>
<p>ans =</p>
<p>‘winvideo’</p>
<p>输入</p>
<pre><code>winvideoinfo = <span class="function"><span class="title">imaqhwinfo</span><span class="params">(<span class="string">'winvideo'</span>)</span></span>
</code></pre><p>返回信息</p>
<p>winvideoinfo =</p>
<p>AdaptorDllName: [1x76 char]</p>
<p>AdaptorDllVersion: ‘1.9 (R14SP3)’</p>
<p>AdaptorName: ‘winvideo’</p>
<p>DeviceIDs: {[1]}</p>
<p>DeviceInfo: [1x1 struct]</p>
<p>输入 </p>
<pre><code><span class="tag">winvideoinfo</span><span class="class">.DeviceInfo</span>
</code></pre><p>返回信息</p>
<p>ans =</p>
<p>DefaultFormat: ‘YUY2_160x120’</p>
<p>DeviceFileSupported: 0</p>
<p>DeviceName: ‘USB 视频设备’</p>
<p>DeviceID: 1</p>
<p>ObjectConstructor: ‘videoinput(‘winvideo’, 1)’</p>
<p>SupportedFormats: {1x5 cell}</p>
<p>输入</p>
<pre><code>device1 = winvideoinfo.<span class="function"><span class="title">DeviceInfo</span><span class="params">(<span class="number">1</span>)</span></span>
</code></pre><p>返回信息</p>
<p>device1 =</p>
<p>DefaultFormat: ‘YUY2_160x120’</p>
<p>DeviceFileSupported: 0</p>
<p>DeviceName: ‘USB 视频设备’</p>
<p>DeviceID: 1</p>
<p>ObjectConstructor: ‘videoinput(‘winvideo’, 1)’</p>
<p>SupportedFormats: {1x5 cell}</p>
<p>输入</p>
<pre><code><span class="tag">device1</span><span class="class">.DeviceName</span>
</code></pre><p>返回信息</p>
<p>ans =</p>
<p>USB 视频设备</p>
<p>输入</p>
<pre><code><span class="tag">device1</span><span class="class">.DeviceID</span>
</code></pre><p>返回信息</p>
<p>ans =</p>
<p>1</p>
<p>输入</p>
<pre><code><span class="tag">device1</span><span class="class">.DefaultFormat</span>
</code></pre><p>返回信息</p>
<p>ans =</p>
<p>YUY2_160x120</p>
<p>输入</p>
<pre><code><span class="tag">device1</span><span class="class">.SupportedFormats</span>
</code></pre><p>返回信息</p>
<p>Columns 1 through 4</p>
<p>‘YUY2_160x120’    ‘YUY2_176x144’    ‘YUY2_320x240’    ‘YUY2_352x288’</p>
<p>Column 5</p>
<p>‘YUY2_640x480’</p>
<p>2、 最简单采集实验,输入如下代码，可以得到预览下的默认格式的摄像头捕捉窗口obj=videoinput(‘winvideo’,1);</p>
<p>preview(obj);</p>
<p>3、 输入如下代码</p>
<pre><code>vidobj = videoinput('winvideo',1,'YUY<span class="number">2_640x48</span>0')<span class="comment">;</span>
sources = vidobj.Source<span class="comment">;</span>
whos sources
set(vidobj,'SelectedSourceName','input1')<span class="comment">;</span>
sources
selectedsrc = getselectedsource(vidobj)<span class="comment">;</span>
get(selectedsrc)<span class="comment">;</span>
delete(vidobj)<span class="comment">;</span>
clear vidobj<span class="comment">;</span>
</code></pre><p>返回信息</p>
<p>Name          Size                    Bytes Class</p>
<p>sources       1x1                       726 videosource object</p>
<p>Grand total is 30 elements using 726 bytes</p>
<p>Display Summary for Video Source Object:</p>
<p>Index:   SourceName:   Selected:</p>
<p>1        ‘input1’      ‘on’</p>
<p>General Settings:</p>
<p>Parent = [1x1 videoinput]</p>
<p>Selected = on</p>
<p>SourceName = input1Tag =</p>
<p>Type = videosource</p>
<p>Device Specific Properties:</p>
<p>BacklightCompensation = on</p>
<p>Brightness = -16</p>
<p>Contrast = 120</p>
<p>FrameRate = 30.0000</p>
<p>Gamma = 60</p>
<p>Hue = 0</p>
<p>Saturation = 40</p>
<p>Sharpness = 3</p>
<p>4、 输入如下代码</p>
<pre><code>clc;
clf;
clear all;
imaqmem(<span class="number">30000000</span>);               <span class="comment">%申请内存空间</span>
<span class="comment">%ADAPTOR:MATLAB与视频设备之间的接口，主要的目的是传递信息</span>
vid = videoinput(<span class="string">'winvideo'</span>, <span class="number">1</span>, <span class="string">'YUY2_640x480'</span>);
preview(vid);
start(vid);
h=figure(<span class="string">'NumberTitle'</span>,<span class="string">'off'</span>,<span class="string">'Name'</span>,<span class="string">'视频'</span>,...

    <span class="string">'MenuBar'</span>,<span class="string">'none'</span>,<span class="string">'color'</span>,<span class="string">'c'</span>,...

    <span class="string">'Position'</span>, <span class="matrix">[<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>]</span>, <span class="string">'Visible'</span>, <span class="string">'on'</span>);         <span class="comment">%新建窗口</span>

set(h,<span class="string">'doublebuffer'</span>,<span class="string">'on'</span>,<span class="string">'outerposition'</span>,get(<span class="number">0</span>,<span class="string">'screensize'</span>));
h1=axes(<span class="string">'Position'</span>, <span class="matrix">[<span class="number">0.02</span>, <span class="number">0.1</span>, <span class="number">0.4</span>, <span class="number">0.8</span>]</span>,<span class="string">'Parent'</span>,h); <span class="comment">%新建显示窗口</span>
hold on;
axis off;
<span class="keyword">while</span> ishandle(h)     <span class="comment">%判断是否有效的图像对象句柄</span>
    a=getsnapshot (vid);     <span class="comment">% 捕获图像</span>
    flushdata(vid);     <span class="comment">%清除数据获取引擎的所有数据、置属性SamplesAvailable为0</span>
    imshow(a);                   <span class="comment">%显示图像</span>
    drawnow;                     <span class="comment">% 实时更新图像</span>
<span class="keyword">end</span>;
delete(vid);
</code></pre>  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/matlab/">matlab</a><a href="/tags/算法/">算法</a>
  </div>


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/matlab/">matlab</a>
</div>



</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2014/05/04/Gray-level Co-occurrence Matrix 灰度共生矩阵/" title="Gray-level Co-occurrence Matrix 灰度共生矩阵">
  <strong>PREVIOUS:</strong><br/>
  <span>
  Gray-level Co-occurrence Matrix 灰度共生矩阵</span>
</a>
</div>


<div class="next">
<a href="/2014/05/04/图像主方向/"  title="图像主方向">
 <strong>NEXT:</strong><br/> 
 <span>图像主方向
</span>
</a>
</div>

</nav>

	
</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">



</aside>
</div>

    </div>
    <footer><div id="footer" >
	
	
	<div class="social-font" class="clearfix">
		
		
		
		
	</div>
		<p class="copyright">Copyright © 2016
		
		snailgoers
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



  </body>
</html>

